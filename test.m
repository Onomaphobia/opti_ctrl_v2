clear all
close all
clc

syms L1 L2 L3 theta1 theta2 theta3 Xdot Ydot u1 u2 u3 xg yg

[T01] = Transform(0, 0,0,theta1);
[T12] = Transform(0,L1, 0,theta2);
[T23] = Transform(0,L2,0,theta3);
[T34] = Transform(0,L3,0,0);
T02 = T01*T12;
T03 = T02*T23;
T04 = T03*T34;




pinvJ =  [                                                                                                                                                                                                                                                        (L3^2*abs(L1)^2*abs(L2)^2*sin(theta1 + theta3 + 2*real(theta2)) - L2^2*sin(theta1 + theta2 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 + L2^2*sin(theta1 + 2*real(theta2) + conj(theta3))*abs(L1)^2*abs(L3)^2 - L3^2*sin(theta1 + theta2 + theta3 - conj(theta2))*abs(L1)^2*abs(L2)^2 - L2*L3*abs(L1)^2*abs(L2)^2*sin(theta1 + theta2 - conj(theta2)) - L1*L3*sin(theta1 + theta2 + theta3 - conj(theta3))*abs(L2)^2*abs(L3)^2 + L2*L3*sin(theta1 + 2*real(theta2))*abs(L1)^2*abs(L2)^2 + 2*L2*L3*sin(theta1 + 2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 - 2*L2*L3*sin(theta1 + theta2 + theta3 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 + L1*L3*abs(L2)^2*abs(L3)^2*sin(theta1 + theta2 + 2*real(theta3)))/(2*(L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3) + L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2) + L1*L2*L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*L1*L2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + L1*L2^2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2) + L1*L2^2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2) + L2^2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3) + L2^2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2))),                                                                                                                                                                                                                                                        (L2^2*cos(theta1 + theta2 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 - L2^2*cos(theta1 + 2*real(theta2) + conj(theta3))*abs(L1)^2*abs(L3)^2 + L3^2*cos(theta1 + theta2 + theta3 - conj(theta2))*abs(L1)^2*abs(L2)^2 - L3^2*abs(L1)^2*abs(L2)^2*cos(theta1 + theta3 + 2*real(theta2)) + L1*L3*cos(theta1 + theta2 + theta3 - conj(theta3))*abs(L2)^2*abs(L3)^2 - L2*L3*cos(theta1 + 2*real(theta2))*abs(L1)^2*abs(L2)^2 - 2*L2*L3*cos(theta1 + 2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 + 2*L2*L3*cos(theta1 + theta2 + theta3 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 - L1*L3*abs(L2)^2*abs(L3)^2*cos(theta1 + theta2 + 2*real(theta3)) + L2*L3*abs(L1)^2*abs(L2)^2*cos(theta1 + theta2 - conj(theta2)))/(2*(L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3) + L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2) + L1*L2*L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*L1*L2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + L1*L2^2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2) + L1*L2^2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2) + L2^2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3) + L2^2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2)));
           -(L3^2*abs(L1)^2*abs(L2)^2*sin(theta1 + theta3 + 2*real(theta2)) - L2^2*sin(theta1 + theta2 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 + L2^2*sin(theta1 + 2*real(theta2) + conj(theta3))*abs(L1)^2*abs(L3)^2 - L3^2*sin(theta1 + theta2 + theta3 - conj(theta2))*abs(L1)^2*abs(L2)^2 - L2*L3*abs(L1)^2*abs(L2)^2*sin(theta1 + theta2 - conj(theta2)) + L1*L2*abs(L1)^2*abs(L3)^2*sin(theta1 + conj(theta2) + conj(theta3)) + L1*L3*sin(theta1 + conj(theta2))*abs(L1)^2*abs(L2)^2 + L1*L2*sin(conj(theta2) - theta1 + conj(theta3))*abs(L1)^2*abs(L3)^2 + L1*L3*sin(theta1 + theta2 + theta3 - conj(theta3))*abs(L2)^2*abs(L3)^2 + L2*L3*sin(theta1 + 2*real(theta2))*abs(L1)^2*abs(L2)^2 - L1*L3*sin(theta1 - conj(theta2))*abs(L1)^2*abs(L2)^2 + L2*L3*sin(theta1 + 2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 - L2*L3*sin(theta1 + theta2 + theta3 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 - L1*L3*abs(L2)^2*abs(L3)^2*sin(theta1 + theta2 + 2*real(theta3)))/(2*(L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3) + L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2) + L1*L2*L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*L1*L2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + L1*L2^2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2) + L1*L2^2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2) + L2^2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3) + L2^2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2))), -(L2^2*cos(theta1 + theta2 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 - L2^2*cos(theta1 + 2*real(theta2) + conj(theta3))*abs(L1)^2*abs(L3)^2 + L3^2*cos(theta1 + theta2 + theta3 - conj(theta2))*abs(L1)^2*abs(L2)^2 - L3^2*abs(L1)^2*abs(L2)^2*cos(theta1 + theta3 + 2*real(theta2)) - L1*L3*cos(theta1 + conj(theta2))*abs(L1)^2*abs(L2)^2 + L1*L2*cos(conj(theta2) - theta1 + conj(theta3))*abs(L1)^2*abs(L3)^2 - L1*L3*cos(theta1 + theta2 + theta3 - conj(theta3))*abs(L2)^2*abs(L3)^2 - L2*L3*cos(theta1 + 2*real(theta2))*abs(L1)^2*abs(L2)^2 + L1*L3*cos(theta1 - conj(theta2))*abs(L1)^2*abs(L2)^2 - L2*L3*cos(theta1 + 2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 + L2*L3*cos(theta1 + theta2 + theta3 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 + L1*L3*abs(L2)^2*abs(L3)^2*cos(theta1 + theta2 + 2*real(theta3)) + L2*L3*abs(L1)^2*abs(L2)^2*cos(theta1 + theta2 - conj(theta2)) - L1*L2*abs(L1)^2*abs(L3)^2*cos(theta1 + conj(theta2) + conj(theta3)))/(2*(L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3) + L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2) + L1*L2*L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*L1*L2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + L1*L2^2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2) + L1*L2^2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2) + L2^2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3) + L2^2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2)));
                                                                                                                                       -(L1^2*sin(theta1 + conj(theta3))*abs(L2)^2*abs(L3)^2 - L2^2*sin(theta1 + theta2 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 + L2^2*sin(theta1 + 2*real(theta2) + conj(theta3))*abs(L1)^2*abs(L3)^2 - L1^2*sin(theta1 - conj(theta3))*abs(L2)^2*abs(L3)^2 - 2*L1*L2*abs(L2)^2*abs(L3)^2*sin(theta1 + theta2 - conj(theta3)) + L1*L2*abs(L1)^2*abs(L3)^2*sin(theta1 + conj(theta2) + conj(theta3)) + L1*L2*sin(conj(theta2) - theta1 + conj(theta3))*abs(L1)^2*abs(L3)^2 - 2*L1*L3*sin(theta1 + theta2 + theta3 - conj(theta3))*abs(L2)^2*abs(L3)^2 + 2*L1*L2*sin(theta1 + theta2 + conj(theta3))*abs(L2)^2*abs(L3)^2 + L2*L3*sin(theta1 + 2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 - L2*L3*sin(theta1 + theta2 + theta3 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 + 2*L1*L3*abs(L2)^2*abs(L3)^2*sin(theta1 + theta2 + 2*real(theta3)))/(2*(L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3) + L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2) + L1*L2*L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*L1*L2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + L1*L2^2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2) + L1*L2^2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2) + L2^2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3) + L2^2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2))),                                                                                                                              (L1^2*cos(theta1 + conj(theta3))*abs(L2)^2*abs(L3)^2 - L2^2*cos(theta1 + theta2 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 + L2^2*cos(theta1 + 2*real(theta2) + conj(theta3))*abs(L1)^2*abs(L3)^2 - L1^2*cos(theta1 - conj(theta3))*abs(L2)^2*abs(L3)^2 - L1*L2*cos(conj(theta2) - theta1 + conj(theta3))*abs(L1)^2*abs(L3)^2 - 2*L1*L3*cos(theta1 + theta2 + theta3 - conj(theta3))*abs(L2)^2*abs(L3)^2 + 2*L1*L2*cos(theta1 + theta2 + conj(theta3))*abs(L2)^2*abs(L3)^2 + L2*L3*cos(theta1 + 2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 - L2*L3*cos(theta1 + theta2 + theta3 - conj(theta2) - conj(theta3))*abs(L1)^2*abs(L3)^2 + 2*L1*L3*abs(L2)^2*abs(L3)^2*cos(theta1 + theta2 + 2*real(theta3)) - 2*L1*L2*abs(L2)^2*abs(L3)^2*cos(theta1 + theta2 - conj(theta3)) + L1*L2*abs(L1)^2*abs(L3)^2*cos(theta1 + conj(theta2) + conj(theta3)))/(2*(L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3) + L1*L3^2*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3) + L1^2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2) + L1*L2*L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*L1*L2*L3*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + L1*L2^2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2) + L1*L2^2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2) + L2^2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3) + L2^2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*L1*L2*L3*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2)))];
                                                                                                                                   
dx = [Xdot;Ydot];

I = eye(3);

J=[ - L2*sin(theta1 + theta2) - L1*sin(theta1) - L3*sin(theta1 + theta2 + theta3), - L2*sin(theta1 + theta2) - L3*sin(theta1 + theta2 + theta3), -L3*sin(theta1 + theta2 + theta3);
      L2*cos(theta1 + theta2) + L1*cos(theta1) + L3*cos(theta1 + theta2 + theta3),   L2*cos(theta1 + theta2) + L3*cos(theta1 + theta2 + theta3),  L3*cos(theta1 + theta2 + theta3)];
  
U = [u1;u2;u3];

% dfduT = simplify(transpose(I - pinvJ*J))

Qdot = simplify(pinvJ*dx + (I - pinvJ*J)*U)

%Qdot_noX = simplify(Qdot)





%cost function 1/Manipulability Measure
% 
% cost = 1/(sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + L3*sin(conj(theta2))*abs(L1)^2*conj(L2)*cos(theta2)*sin(theta3) + L3*sin(conj(theta2))*abs(L1)^2*conj(L2)*cos(theta3)*sin(theta2) + L1*sin(conj(theta3))*abs(L3)^2*conj(L2)*cos(theta2)*sin(theta3) + L1*sin(conj(theta3))*abs(L3)^2*conj(L2)*cos(theta3)*sin(theta2) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*conj(L3)*sin(theta2) + L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*conj(L3)*sin(theta2) + L2*cos(conj(theta2))*sin(conj(theta3))*abs(L3)^2*conj(L1)*sin(theta3) + L2*cos(conj(theta3))*sin(conj(theta2))*abs(L3)^2*conj(L1)*sin(theta3))^(1/2);
%  
%MM = (sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + L3*sin(conj(theta2))*abs(L1)^2*conj(L2)*cos(theta2)*sin(theta3) + L3*sin(conj(theta2))*abs(L1)^2*conj(L2)*cos(theta3)*sin(theta2) + L1*sin(conj(theta3))*abs(L3)^2*conj(L2)*cos(theta2)*sin(theta3) + L1*sin(conj(theta3))*abs(L3)^2*conj(L2)*cos(theta3)*sin(theta2) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*conj(L3)*sin(theta2) + L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*conj(L3)*sin(theta2) + L2*cos(conj(theta2))*sin(conj(theta3))*abs(L3)^2*conj(L1)*sin(theta3) + L2*cos(conj(theta3))*sin(conj(theta2))*abs(L3)^2*conj(L1)*sin(theta3))^(1/2); 



% 
% %task priority
% %differential of cost function
% dldq=[ 0;
%        -(sin(2*real(theta2))*abs(L1)^2*abs(L2)^2 + 2*sin(2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 + (L2*abs(L1)^2*abs(L3)^2*sin(2*real(theta3) + conj(theta2)))/(2*L1) + (L2*abs(L1)^2*abs(L3)^2*sin(2*real(theta2) + conj(theta3)))/L3 - (L1*abs(L2)^2*abs(L3)^2*sin(theta2 + theta3 - conj(theta3)))/(2*L2) - (L2*sin(conj(theta2) - theta3 + conj(theta3))*abs(L1)^2*abs(L3)^2)/(2*L1) + (L1*sin(theta2 + 2*real(theta3))*abs(L2)^2*abs(L3)^2)/(2*L2) + (L3*sin(theta3 + 2*real(theta2))*abs(L1)^2*abs(L2)^2)/L2)/(2*(sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + (L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3))/L2 + (L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2))/L2 + (L1*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3))/L2 + (L1*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2))/L2 + (L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3))/L1 + (L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3))/L1 + (L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2))/L3 + (L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2))/L3)^(3/2));
%      -(2*sin(2*real(theta3))*abs(L2)^2*abs(L3)^2 + 2*sin(2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 + (L2*abs(L1)^2*abs(L3)^2*sin(2*real(theta3) + conj(theta2)))/L1 + (L2*abs(L1)^2*abs(L3)^2*sin(2*real(theta2) + conj(theta3)))/(2*L3) - (L3*abs(L1)^2*abs(L2)^2*sin(theta2 + theta3 - conj(theta2)))/(2*L2) - (L2*sin(conj(theta2) - theta2 + conj(theta3))*abs(L1)^2*abs(L3)^2)/(2*L3) + (L1*sin(theta2 + 2*real(theta3))*abs(L2)^2*abs(L3)^2)/L2 + (L3*sin(theta3 + 2*real(theta2))*abs(L1)^2*abs(L2)^2)/(2*L2))/(2*(sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + (L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3))/L2 + (L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2))/L2 + (L1*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3))/L2 + (L1*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2))/L2 + (L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3))/L1 + (L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3))/L1 + (L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2))/L3 + (L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2))/L3)^(3/2))];
%  
% 
% %differential of MM
% dmdq =[
%  
%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       0;
%    (sin(2*real(theta2))*abs(L1)^2*abs(L2)^2 + 2*sin(2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 + (L2*abs(L1)^2*abs(L3)^2*sin(2*real(theta3) + conj(theta2)))/(2*L1) + (L2*abs(L1)^2*abs(L3)^2*sin(2*real(theta2) + conj(theta3)))/L3 - (L1*abs(L2)^2*abs(L3)^2*sin(theta2 + theta3 - conj(theta3)))/(2*L2) - (L2*sin(conj(theta2) - theta3 + conj(theta3))*abs(L1)^2*abs(L3)^2)/(2*L1) + (L1*sin(theta2 + 2*real(theta3))*abs(L2)^2*abs(L3)^2)/(2*L2) + (L3*sin(theta3 + 2*real(theta2))*abs(L1)^2*abs(L2)^2)/L2)/(2*(sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + (L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3))/L2 + (L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2))/L2 + (L1*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3))/L2 + (L1*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2))/L2 + (L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3))/L1 + (L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3))/L1 + (L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2))/L3 + (L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2))/L3)^(1/2));
%  (2*sin(2*real(theta3))*abs(L2)^2*abs(L3)^2 + 2*sin(2*real(theta2) + 2*real(theta3))*abs(L1)^2*abs(L3)^2 + (L2*abs(L1)^2*abs(L3)^2*sin(2*real(theta3) + conj(theta2)))/L1 + (L2*abs(L1)^2*abs(L3)^2*sin(2*real(theta2) + conj(theta3)))/(2*L3) - (L3*abs(L1)^2*abs(L2)^2*sin(theta2 + theta3 - conj(theta2)))/(2*L2) - (L2*sin(conj(theta2) - theta2 + conj(theta3))*abs(L1)^2*abs(L3)^2)/(2*L3) + (L1*sin(theta2 + 2*real(theta3))*abs(L2)^2*abs(L3)^2)/L2 + (L3*sin(theta3 + 2*real(theta2))*abs(L1)^2*abs(L2)^2)/(2*L2))/(2*(sin(conj(theta2))*abs(L1)^2*abs(L2)^2*sin(theta2) + 2*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta2)*sin(theta3) + 2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*cos(theta3)*sin(theta2) + (L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta2)*sin(theta3))/L2 + (L3*sin(conj(theta2))*abs(L1)^2*abs(L2)^2*cos(theta3)*sin(theta2))/L2 + (L1*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta2)*sin(theta3))/L2 + (L1*sin(conj(theta3))*abs(L2)^2*abs(L3)^2*cos(theta3)*sin(theta2))/L2 + (L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta3))/L1 + (L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta3))/L1 + (L2*cos(conj(theta2))*sin(conj(theta3))*abs(L1)^2*abs(L3)^2*sin(theta2))/L3 + (L2*cos(conj(theta3))*sin(conj(theta2))*abs(L1)^2*abs(L3)^2*sin(theta2))/L3)^(1/2))];
%  
%  

 

